[TASK]
type=zip_audit
target=errors,compatibility,best_practices
depth=exhaustive
report=all_findings:not_just_obvious

[FORMAT]
findings=table
examples=code_blocks

[ENVIRONMENT]
os=CachyOS
shell=fish
init=systemd
hardware=AMD_Strix_Halo

[SCOPE]
include=shell_scripts,systemd_units,config_files
skip=binaries,images

[STEP:1:VERIFY]
command=unzip -t <archive>
on_fail=report_error,stop

[STEP:2:EXTRACT]
action=extract_all
preserve=directory_structure
on_empty_scope=report,stop

[STEP:3:READ_DOCS]
targets=README,INSTALL,inline_comments
gather=behavior,dependencies,assumptions

[STEP:4:SYNTAX_CHECK]
fish=fish --no-execute <file>
systemd=systemd-analyze verify <unit>
yaml=yq eval '.' <file>
yaml_note=mikefarah/yq
toml=taplo check <file>

[STEP:5:ANALYZE]
depth=line_by_line
thoroughness=flag_all_issues:including_minor
orphan_refs=undefined_functions,undefined_variables,missing_files,unused_variables,unused_functions
missing_deps=undeclared_commands,undeclared_packages,invalid_paths,missing_error_handling
security=unsafe_permissions,unquoted_variables,world_writable,hardcoded_secrets,injection_risks
compatibility=bash_isms_in_fish,deprecated_commands,non_portable_paths,version_assumptions
logic=race_conditions,unhandled_edge_cases,missing_validation,silent_failures,unchecked_return_codes
idempotency=operations_unsafe_to_run_twice,missing_guards,state_assumptions
style=inconsistent_naming,missing_comments,poor_structure,magic_numbers

[STEP:6:WEB_VERIFY]
sources=arch_wiki,cachyos_wiki
verify=package_names,systemd_syntax,standard_paths
on_no_source=note_assumption,proceed

[STEP:7:GENERATE_TABLE]
columns=#,Severity,File,Line,Issue,Recommendation
severity_order=CRITICAL>HIGH>MEDIUM>LOW
sort=severity_descending
include=all_severities:not_just_critical_high

[STEP:8:FIX]
target=all_findings
method=in_place
preserve=directory_structure
on_conflict=prioritize_higher_severity,note_tradeoff

[STEP:9:RECHECK]
action=rerun_syntax_checks
target=modified_files
on_new_errors=fix,repeat_until_clean

[STEP:10:VERIFY_LOOP]
10a=rerun_analysis:steps_4_5:on_modified_files
10b=if_findings_remain:fix,repeat
10c=max_passes=3
10d=on_persist=report_unresolved,explain

[STEP:11:OUTPUT]
present=changed_files_only
format=separate_individual_files
exclude=unmodified_files
on_no_changes=report:"No findings requiring fixes"
